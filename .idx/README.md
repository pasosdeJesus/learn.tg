# IDX Environment Guide for Development

This document outlines specific configurations and workarounds for developing within the IDX (Firebase Studio) environment.

## PostgreSQL Database

This environment includes a pre-configured PostgreSQL instance.

### Starting the Server

To start the PostgreSQL server, run the following script from the repository root:

```bash
.idx/startpg.sh
```

### Stopping the Server

To stop the PostgreSQL server, run this script:

```bash
.idx/stoppg.sh
```

### Superuser Credentials

The default superuser for the database is:

*   **Username:** `user`
*   **Password:** (intentionally left blank)

**Important:** When running tests or using project-level scripts that require superuser access, you must reflect this in the appropriate `.env` files. For instance, projects generated by `m` default to `PG_SUPERUSER=postgres`, which will fail in this environment unless you change it to `user`.

## Environment-Specific Workarounds

Developing in this IDX environment requires awareness of certain tool behaviors:

*   **Invisible Configuration Files:** The IDE's file explorer and some of its API tools (`read_file`, `list_files`) may fail to correctly display or read dotfiles (e.g., `.env`). The `read_file` tool, for instance, might return an empty string for a file that contains data.

*   **Reliable Solution:** Always use the terminal for critical file operations. This is the most reliable way to confirm file state.
    *   **To verify a file's existence and see its permissions:** `ls -la <path/to/file>`
    *   **To read a file's content:** `cat <path/to/file>`

This knowledge is essential for debugging file-related issues and for tasks like verifying the contents of an `.env` file in a newly scaffolded project.

## Understanding Nix Instantiation

When working with Nix files in this environment, it's helpful to understand the difference between parsing and evaluating expressions.

| Aspect | `nix-instantiate --parse-only` | `nix-instantiate --arg ...` |
| :--- | :--- | :--- |
| **Primary Goal** | Check syntax | Produce a buildable derivation |
| **Depth** | Shallow (just grammar) | Deep (grammar, logic, references) |
| **Context** | Ignores external variables like `pkgs` | **Requires** `pkgs` to be provided |
| **Success Output** | Nothing | A path to a `.drv` file in `/nix/store` |
| **Use Case** | Quick linting, pre-commit hooks | Actually building the environment, testing the logic |
